<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Theloders - Downloader</title>
    <script src="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js" crossOrigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/react-dom@18/umd/react-dom.development.js" crossOrigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@babel/standalone/babel.min.js" crossOrigin="anonymous"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preload" href="https://cdn.jsdelivr.net/npm/react@18/umd/react.development.js" as="script">
</head>
<body>
    <div id="root"></div>
    <script type="text/babel">
        const { useState, useEffect } = React;

        function App() {
            const [selectedOption, setSelectedOption] = useState('');
            const [link, setLink] = useState('');
            const [quality, setQuality] = useState('');
            const [format, setFormat] = useState('mp4');
            const [fileName, setFileName] = useState('');
            const [progress, setProgress] = useState({});
            const [loading, setLoading] = useState(false);
            const [error, setError] = useState('');
            const [theme, setTheme] = useState('light');
            const [queue, setQueue] = useState([]);
            const [points, setPoints] = useState(0);
            const [badges, setBadges] = useState([]);

            useEffect(() => {
                const ws = new WebSocket('wss://your-render-app.onrender.com');
                ws.onmessage = (event) => {
                    const data = JSON.parse(event.data);
                    if (data.progress && data.id) {
                        setProgress(prev => ({ ...prev, [data.id]: data.progress }));
                    }
                };
                return () => ws.close();
            }, []);

            const selectOption = (option) => {
                setSelectedOption(option);
                setError('');
            };

            const addToQueue = () => {
                if (!link.trim() || (selectedOption === 'video' && !quality)) {
                    setError('Please provide a valid link and quality (if video)!');
                    return;
                }
                const id = Date.now();
                setQueue([...queue, { id, link, type: selectedOption, quality, format, fileName: fileName || `downloaded_${selectedOption}` }]);
                setLink('');
                setQuality('');
                setFileName('');
                setSelectedOption('');
            };

            const processQueue = async () => {
                for (const item of queue) {
                    setLoading(true);
                    setError('');
                    try {
                        const response = await fetch(`https://your-render-app.onrender.com/download?link=${encodeURIComponent(item.link)}&type=${item.type}&quality=${item.quality}&format=${item.format}&filename=${encodeURIComponent(item.fileName)}`, {
                            method: 'GET',
                            signal: AbortSignal.timeout(30000)
                        });
                        if (!response.ok) throw new Error('Download failed');
                        const blob = await response.blob();
                        const url = window.URL.createObjectURL(blob);
                        const a = document.createElement('a');
                        a.href = url;
                        a.download = `${item.fileName}.${item.format}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                        window.URL.revokeObjectURL(url);
                        setPoints(points + 10); // Award 10 points
                        if (points + 10 >= 50 && !badges.includes('Bronze')) setBadges([...badges, 'Bronze']);
                        setQueue(queue.filter(q => q.id !== item.id));
                    } catch (err) {
                        setError(`Error for ${item.link}: ${err.message}`);
                    }
                    setLoading(false);
                }
            };

            const shareOnSocial = (url) => {
                const shareUrl = `https://twitter.com/intent/tweet?text=Check out my download from Theloders: ${url}`;
                window.open(shareUrl, '_blank');
            };

            return (
                <div className={`min-h-screen flex flex-col items-center justify-center p-4 ${theme === 'dark' ? 'bg-gray-900 text-white' : 'bg-gray-100 text-gray-900'}`}>
                    <div className="absolute top-4 right-4">
                        <button onClick={() => setTheme(theme === 'light' ? 'dark' : 'light')} className="bg-white border-2 border-orange-500 text-orange-500 px-4 py-2 rounded-full hover:bg-orange-500 hover:text-white transition">Toggle Theme</button>
                    </div>
                    <div className="text-center">
                        <h3 className="text-orange-500 text-lg">Theloders</h3>
                        <h1 className="text-5xl font-bold"><span className="text-orange-500">Download's</span></h1>
                    </div>
                    <div className="flex gap-4 my-6">
                        {['video', 'audio', 'both'].map(option => (
                            <button
                                key={option}
                                onClick={() => selectOption(option)}
                                className={`px-6 py-3 rounded-full text-white ${selectedOption === option ? 'bg-orange-600' : 'bg-orange-500'} hover:bg-orange-600 transition`}
                            >
                                {option.charAt(0).toUpperCase() + option.slice(1)}
                            </button>
                        ))}
                    </div>
                    <div className="flex gap-4 mb-6">
                        <input
                            type="text"
                            value={link}
                            onChange={(e) => setLink(e.target.value)}
                            placeholder="Paste the link"
                            className="w-96 p-3 rounded-full border-2 border-orange-500 focus:border-orange-600 outline-none"
                        />
                        <button
                            onClick={addToQueue}
                            className="px-6 py-3 bg-orange-500 text-white rounded-full hover:bg-orange-600 transition disabled:bg-gray-400"
                            disabled={loading}
                        >
                            {loading ? 'Adding...' : 'Add to Queue'}
                        </button>
                    </div>
                    {selectedOption && (
                        <>
                            {selectedOption === 'video' && (
                                <div className="bg-white p-6 rounded-lg shadow-md mb-4">
                                    {['360p', '720p', '1080p', '2k', '4k'].map(q => (
                                        <label key={q} className="block">
                                            <input
                                                type="radio"
                                                name="quality"
                                                value={q}
                                                checked={quality === q}
                                                onChange={(e) => setQuality(e.target.value)}
                                                className="mr-2"
                                            /> {q}
                                        </label>
                                    ))}
                                </div>
                            )}
                            {selectedOption === 'audio' && (
                                <div className="bg-white p-6 rounded-lg shadow-md mb-4">
                                    {['low', 'medium', 'high'].map(q => (
                                        <label key={q} className="block">
                                            <input
                                                type="radio"
                                                name="audioQuality"
                                                value={q}
                                                checked={quality === q}
                                                onChange={(e) => setQuality(e.target.value)}
                                                className="mr-2"
                                            /> {q.charAt(0).toUpperCase() + q.slice(1)}
                                        </label>
                                    ))}
                                </div>
                            )}
                            <div className="bg-white p-6 rounded-lg shadow-md mb-4">
                                <select
                                    value={format}
                                    onChange={(e) => setFormat(e.target.value)}
                                    className="w-full p-2 rounded-full border-2 border-orange-500 focus:border-orange-600"
                                >
                                    <option value="mp4">MP4</option>
                                    <option value="mp3">MP3</option>
                                    <option value="wav">WAV</option>
                                </select>
                            </div>
                            <div className="bg-white p-6 rounded-lg shadow-md">
                                <input
                                    type="text"
                                    value={fileName}
                                    onChange={(e) => setFileName(e.target.value)}
                                    placeholder="Enter filename (leave empty for default)"
                                    className="w-full p-2 rounded-full border-2 border-orange-500 focus:border-orange-600"
                                />
                            </div>
                        </>
                    )}
                    <button
                        onClick={processQueue}
                        className="mt-4 px-6 py-3 bg-green-500 text-white rounded-full hover:bg-green-600 transition disabled:bg-gray-400"
                        disabled={loading || queue.length === 0}
                    >
                        Process Queue
                    </button>
                    <div className="mt-4">
                        {queue.map(item => (
                            <div key={item.id} className="flex justify-between items-center p-2 bg-gray-200 rounded mb-2">
                                <span>{item.link} ({item.type})</span>
                                <span>Progress: {progress[item.id] || 0}%</span>
                            </div>
                        ))}
                    </div>
                    {error && <div className="mt-4 text-red-500">{error}</div>}
                    <div className="mt-6 text-center">
                        <p>Points: {points}</p>
                        <p>Badges: {badges.join(', ')}</p>
                    </div>
                    {progress[queue[queue.length - 1]?.id] === 100 && (
                        <div className="mt-6 p-6 rounded-lg bg-green-500 text-white">
                            <h1 className="text-4xl">THANKS</h1>
                            <h2 className="text-2xl">FOR USING</h2>
                            <p>Downloaded</p>
                            <button onClick={() => shareOnSocial(link)} className="mt-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600">Share on Twitter</button>
                        </div>
                    )}
                </div>
            );
        }

        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>


